# HTTP vs RPCï¼šè·¨å¾®æœåŠ¡è°ƒç”¨çš„ç¬¬ä¸€æ€§åŸç†è§£æ

## ğŸ“š ç›®å½•
1. [ç¬¬ä¸€æ€§åŸç†ï¼šé€šä¿¡çš„æœ¬è´¨](#ç¬¬ä¸€æ€§åŸç†é€šä¿¡çš„æœ¬è´¨)
2. [HTTP çš„æœ¬è´¨](#http-çš„æœ¬è´¨)
3. [RPC çš„æœ¬è´¨](#rpc-çš„æœ¬è´¨)
4. [æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”](#æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”)
5. [å¾®æœåŠ¡åœºæ™¯ä¸‹çš„é€‰æ‹©](#å¾®æœåŠ¡åœºæ™¯ä¸‹çš„é€‰æ‹©)
6. [é¡¹ç›®ä¸­çš„å®ç°](#é¡¹ç›®ä¸­çš„å®ç°)

---

## ç¬¬ä¸€æ€§åŸç†ï¼šé€šä¿¡çš„æœ¬è´¨

### é—®é¢˜çš„æœ¬è´¨

**è·¨å¾®æœåŠ¡è°ƒç”¨ = è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPC - Inter-Process Communicationï¼‰**

ä¸¤ä¸ªæœåŠ¡è¿è¡Œåœ¨ä¸åŒçš„è¿›ç¨‹ä¸­ï¼ˆç”šè‡³ä¸åŒçš„æœºå™¨ä¸Šï¼‰ï¼Œå®ƒä»¬éœ€è¦ï¼š
1. **ä¼ é€’æ•°æ®**ï¼šå‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”
2. **ç†è§£æ•°æ®**ï¼šåŒæ–¹éƒ½èƒ½ç†è§£æ•°æ®çš„æ ¼å¼å’Œå«ä¹‰
3. **å¤„ç†é”™è¯¯**ï¼šç½‘ç»œæ•…éšœã€æœåŠ¡ä¸å¯ç”¨ç­‰æƒ…å†µ

### é€šä¿¡çš„åŸºæœ¬è¦ç´ 

```
æœåŠ¡A                         æœåŠ¡B
  â”‚                            â”‚
  â”‚  1. åºåˆ—åŒ–ï¼ˆç¼–ç ï¼‰          â”‚
  â”‚  å°†å¯¹è±¡ â†’ å­—èŠ‚æµ            â”‚
  â”‚                            â”‚
  â”‚  2. ä¼ è¾“                   â”‚
  â”‚  é€šè¿‡ç½‘ç»œå‘é€å­—èŠ‚æµ         â”‚
  â”‚                            â”‚
  â”‚                            â”‚  3. ååºåˆ—åŒ–ï¼ˆè§£ç ï¼‰
  â”‚                            â”‚  å­—èŠ‚æµ â†’ å¯¹è±¡
  â”‚                            â”‚
  â”‚                            â”‚  4. å¤„ç†
  â”‚                            â”‚  æ‰§è¡Œä¸šåŠ¡é€»è¾‘
  â”‚                            â”‚
  â”‚  5. è¿”å›å“åº”               â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

**å…³é”®é—®é¢˜ï¼š**
- **å¦‚ä½•ç¼–ç æ•°æ®ï¼Ÿ**ï¼ˆåºåˆ—åŒ–æ ¼å¼ï¼‰
- **å¦‚ä½•ä¼ è¾“æ•°æ®ï¼Ÿ**ï¼ˆä¼ è¾“åè®®ï¼‰
- **å¦‚ä½•è°ƒç”¨ï¼Ÿ**ï¼ˆè°ƒç”¨æ–¹å¼ï¼‰

---

## HTTP çš„æœ¬è´¨

### ä»€ä¹ˆæ˜¯ HTTPï¼Ÿ

**HTTP = HyperText Transfer Protocolï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰**

#### ç¬¬ä¸€æ€§åŸç†

HTTP æ˜¯ä¸€ä¸ª**åº”ç”¨å±‚åè®®**ï¼Œè®¾è®¡ç”¨äºï¼š
- **ä¼ è¾“æ–‡æ¡£**ï¼šæœ€åˆç”¨äºä¼ è¾“ HTML æ–‡æ¡£
- **æ— çŠ¶æ€**ï¼šæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„
- **åŸºäºæ–‡æœ¬**ï¼šäººç±»å¯è¯»çš„æ ¼å¼ï¼ˆè™½ç„¶ç°åœ¨ä¹Ÿæ”¯æŒäºŒè¿›åˆ¶ï¼‰

#### HTTP çš„æ ¸å¿ƒç‰¹å¾

```
HTTP è¯·æ±‚æ ¼å¼ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET /api/users/1 HTTP/1.1          â† è¯·æ±‚è¡Œï¼ˆæ–¹æ³• + è·¯å¾„ + åè®®ç‰ˆæœ¬ï¼‰
Host: localhost:8081              â† è¯·æ±‚å¤´
Content-Type: application/json    â† è¯·æ±‚å¤´
                                  â† ç©ºè¡Œ
{                                  â† è¯·æ±‚ä½“ï¼ˆå¯é€‰ï¼‰
  "name": "John"
}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

HTTP å“åº”æ ¼å¼ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HTTP/1.1 200 OK                  â† çŠ¶æ€è¡Œï¼ˆåè®®ç‰ˆæœ¬ + çŠ¶æ€ç  + çŠ¶æ€æ–‡æœ¬ï¼‰
Content-Type: application/json    â† å“åº”å¤´
Content-Length: 123               â† å“åº”å¤´
                                  â† ç©ºè¡Œ
{                                  â† å“åº”ä½“
  "id": 1,
  "name": "John"
}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

#### HTTP åœ¨å¾®æœåŠ¡ä¸­çš„ä½¿ç”¨

**RESTful APIï¼ˆæˆ‘ä»¬é¡¹ç›®ä½¿ç”¨çš„ï¼‰ï¼š**

```java
// æœåŠ¡A è°ƒç”¨ æœåŠ¡B
// ä½¿ç”¨ HTTP GET è¯·æ±‚

@FeignClient(name = "user-service")
public interface UserServiceClient {
    @GetMapping("/api/users/{id}")  // â† HTTP GET æ–¹æ³•
    UserResponse getUserById(@PathVariable Long id);
}

// å®é™…å‘é€çš„ HTTP è¯·æ±‚ï¼š
// GET http://localhost:8081/api/users/1 HTTP/1.1
// Host: localhost:8081
```

**ç‰¹ç‚¹ï¼š**
- âœ… **æ ‡å‡†åŒ–**ï¼šHTTP æ˜¯æ ‡å‡†åè®®ï¼Œæ‰€æœ‰è¯­è¨€éƒ½æ”¯æŒ
- âœ… **äººç±»å¯è¯»**ï¼šè¯·æ±‚å’Œå“åº”éƒ½å¯ä»¥ç›´æ¥æŸ¥çœ‹
- âœ… **å·¥å…·ä¸°å¯Œ**ï¼šæµè§ˆå™¨ã€Postmanã€curl éƒ½å¯ä»¥æµ‹è¯•
- âœ… **é˜²ç«å¢™å‹å¥½**ï¼šHTTP/HTTPS ç«¯å£é€šå¸¸å¼€æ”¾
- âŒ **å¼€é”€è¾ƒå¤§**ï¼šHTTP å¤´ä¿¡æ¯è¾ƒå¤š
- âŒ **æ€§èƒ½ç›¸å¯¹è¾ƒä½**ï¼šæ–‡æœ¬æ ¼å¼ï¼Œåºåˆ—åŒ–/ååºåˆ—åŒ–å¼€é”€

---

## RPC çš„æœ¬è´¨

### ä»€ä¹ˆæ˜¯ RPCï¼Ÿ

**RPC = Remote Procedure Callï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰**

#### ç¬¬ä¸€æ€§åŸç†

RPC çš„ç›®æ ‡æ˜¯ï¼š**è®©è¿œç¨‹è°ƒç”¨çœ‹èµ·æ¥åƒæœ¬åœ°å‡½æ•°è°ƒç”¨**

```
æœ¬åœ°è°ƒç”¨ï¼š
  result = userService.getUserById(1);  // ç›´æ¥è°ƒç”¨

RPC è°ƒç”¨ï¼š
  result = userService.getUserById(1);  // çœ‹èµ·æ¥ä¸€æ ·ï¼Œä½†å®é™…æ˜¯è¿œç¨‹è°ƒç”¨
```

#### RPC çš„æ ¸å¿ƒç‰¹å¾

**RPC æ¡†æ¶çš„å·¥ä½œæµç¨‹ï¼š**

```
1. å®šä¹‰æ¥å£ï¼ˆIDL - Interface Definition Languageï¼‰
   service UserService {
     rpc GetUser(UserRequest) returns (UserResponse);
   }

2. ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»£ç 
   - å®¢æˆ·ç«¯ï¼šStubï¼ˆå­˜æ ¹ï¼‰ï¼Œçœ‹èµ·æ¥åƒæœ¬åœ°å¯¹è±¡
   - æœåŠ¡ç«¯ï¼šSkeletonï¼ˆéª¨æ¶ï¼‰ï¼Œå¤„ç†è¿œç¨‹è°ƒç”¨

3. è°ƒç”¨è¿‡ç¨‹
   å®¢æˆ·ç«¯è°ƒç”¨ Stub
     â†“
   Stub åºåˆ—åŒ–å‚æ•°
     â†“
   é€šè¿‡ç½‘ç»œå‘é€ï¼ˆä½¿ç”¨è‡ªå®šä¹‰åè®®ï¼‰
     â†“
   æœåŠ¡ç«¯ Skeleton æ¥æ”¶
     â†“
   Skeleton ååºåˆ—åŒ–å‚æ•°
     â†“
   è°ƒç”¨å®é™…çš„æœåŠ¡æ–¹æ³•
     â†“
   è¿”å›ç»“æœï¼ˆåå‘è¿‡ç¨‹ï¼‰
```

#### RPC åè®®ç¤ºä¾‹

**gRPCï¼ˆGoogle çš„ RPC æ¡†æ¶ï¼‰ä½¿ç”¨ Protocol Buffersï¼š**

```protobuf
// å®šä¹‰æ¥å£ï¼ˆ.proto æ–‡ä»¶ï¼‰
service UserService {
  rpc GetUser(GetUserRequest) returns (UserResponse);
}

message GetUserRequest {
  int64 id = 1;
}

message UserResponse {
  int64 id = 1;
  string name = 2;
  string email = 3;
}
```

**è°ƒç”¨ï¼š**
```java
// å®¢æˆ·ç«¯ä»£ç ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
UserServiceBlockingStub stub = UserServiceGrpc.newBlockingStub(channel);
UserResponse user = stub.getUser(GetUserRequest.newBuilder().setId(1).build());
```

**ç‰¹ç‚¹ï¼š**
- âœ… **æ€§èƒ½é«˜**ï¼šäºŒè¿›åˆ¶åè®®ï¼Œåºåˆ—åŒ–æ•ˆç‡é«˜
- âœ… **ç±»å‹å®‰å…¨**ï¼šå¼ºç±»å‹ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥
- âœ… **æµå¼ä¼ è¾“**ï¼šæ”¯æŒæµå¼è°ƒç”¨ï¼ˆgRPCï¼‰
- âœ… **ä»£ç ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»£ç 
- âŒ **å­¦ä¹ æ›²çº¿**ï¼šéœ€è¦å­¦ä¹  IDL å’Œæ¡†æ¶
- âŒ **è°ƒè¯•å›°éš¾**ï¼šäºŒè¿›åˆ¶æ ¼å¼ï¼Œä¸æ˜“è°ƒè¯•
- âŒ **ç”Ÿæ€é™åˆ¶**ï¼šä¸åŒ RPC æ¡†æ¶ä¸äº’é€š

---

## æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”

### 1. åè®®å±‚é¢

| ç‰¹æ€§ | HTTP/REST | RPC |
|------|-----------|-----|
| **åè®®ç±»å‹** | åº”ç”¨å±‚åè®®ï¼ˆHTTP/HTTPSï¼‰ | ä¼ è¾“å±‚åè®®ï¼ˆTCP/UDPï¼‰ |
| **æ•°æ®æ ¼å¼** | æ–‡æœ¬ï¼ˆJSON/XMLï¼‰æˆ–äºŒè¿›åˆ¶ | äºŒè¿›åˆ¶ï¼ˆProtocol Buffersã€Thriftç­‰ï¼‰ |
| **å¯è¯»æ€§** | äººç±»å¯è¯» | äºŒè¿›åˆ¶ï¼Œä¸å¯è¯» |
| **æ ‡å‡†åŒ–** | æ ‡å‡†åè®®ï¼ˆRFCï¼‰ | æ¡†æ¶ç‰¹å®šåè®® |

### 2. è°ƒç”¨æ–¹å¼

#### HTTP/REST

```java
// æ˜¾å¼çš„ HTTP è°ƒç”¨
@FeignClient(name = "user-service")
public interface UserServiceClient {
    @GetMapping("/api/users/{id}")  // â† æ˜ç¡®æŒ‡å®š HTTP æ–¹æ³•å’Œè·¯å¾„
    UserResponse getUserById(@PathVariable Long id);
}

// è°ƒç”¨æ—¶ï¼š
UserResponse user = userServiceClient.getUserById(1);

// å®é™…å‘é€ï¼š
// GET /api/users/1 HTTP/1.1
// Host: user-service:8081
```

**ç‰¹ç‚¹ï¼š**
- è°ƒç”¨æ–¹å¼**æ˜¾å¼**ï¼šæ˜ç¡®çŸ¥é“æ˜¯ HTTP è¯·æ±‚
- URL è·¯å¾„**è¯­ä¹‰åŒ–**ï¼š`/api/users/1` è¡¨ç¤ºèµ„æº
- HTTP æ–¹æ³•æœ‰**è¯­ä¹‰**ï¼šGETï¼ˆæŸ¥è¯¢ï¼‰ã€POSTï¼ˆåˆ›å»ºï¼‰ã€PUTï¼ˆæ›´æ–°ï¼‰ã€DELETEï¼ˆåˆ é™¤ï¼‰

#### RPC

```java
// çœ‹èµ·æ¥åƒæœ¬åœ°è°ƒç”¨
UserServiceStub stub = ...;
UserResponse user = stub.getUserById(1);  // â† çœ‹èµ·æ¥åƒæœ¬åœ°æ–¹æ³•è°ƒç”¨

// å®é™…å‘é€ï¼š
// äºŒè¿›åˆ¶æ•°æ®åŒ…ï¼ˆProtocol Buffers ç¼–ç ï¼‰
// åŒ…å«ï¼šæœåŠ¡åã€æ–¹æ³•åã€å‚æ•°
```

**ç‰¹ç‚¹ï¼š**
- è°ƒç”¨æ–¹å¼**éšå¼**ï¼šçœ‹èµ·æ¥åƒæœ¬åœ°è°ƒç”¨
- æ–¹æ³•å**ç›´æ¥**ï¼š`getUserById` å°±æ˜¯æ–¹æ³•å
- ä¸å…³å¿ƒ**ä¼ è¾“ç»†èŠ‚**ï¼šæ¡†æ¶å¤„ç†åºåˆ—åŒ–å’Œä¼ è¾“

### 3. åºåˆ—åŒ–æ–¹å¼

#### HTTP/RESTï¼ˆJSONï¼‰

```json
// è¯·æ±‚ä½“
{
  "id": 1,
  "name": "John",
  "email": "john@example.com"
}

// ç‰¹ç‚¹ï¼š
// - æ–‡æœ¬æ ¼å¼ï¼Œäººç±»å¯è¯»
// - ä½“ç§¯è¾ƒå¤§ï¼ˆå­—æ®µåé‡å¤ï¼‰
// - è§£æé€Ÿåº¦è¾ƒæ…¢
// - ç±»å‹ä¿¡æ¯ä¸¢å¤±ï¼ˆéƒ½æ˜¯å­—ç¬¦ä¸²ï¼‰
```

#### RPCï¼ˆProtocol Buffersï¼‰

```
// äºŒè¿›åˆ¶æ ¼å¼ï¼ˆä¸å¯è¯»ï¼‰
[0x08, 0x01, 0x12, 0x04, 0x4A, 0x6F, 0x68, 0x6E, ...]

// ç‰¹ç‚¹ï¼š
// - äºŒè¿›åˆ¶æ ¼å¼ï¼Œä½“ç§¯å°
// - è§£æé€Ÿåº¦å¿«
// - ç±»å‹å®‰å…¨ï¼ˆå¼ºç±»å‹ï¼‰
// - å‘åå…¼å®¹ï¼ˆç‰ˆæœ¬ç®¡ç†ï¼‰
```

**æ€§èƒ½å¯¹æ¯”ï¼š**

```
åºåˆ—åŒ–é€Ÿåº¦ï¼šRPC > HTTP/JSON
æ•°æ®ä½“ç§¯ï¼šRPC < HTTP/JSON
å¯è¯»æ€§ï¼šHTTP/JSON > RPC
```

### 4. æœåŠ¡å‘ç°é›†æˆ

#### HTTP/RESTï¼ˆæˆ‘ä»¬é¡¹ç›®ï¼‰

```yaml
# API Gateway é…ç½®
spring:
  cloud:
    gateway:
      routes:
        - id: user-service
          uri: lb://user-service  # â† æœåŠ¡å
          predicates:
            - Path=/api/users/**
```

**å·¥ä½œæ–¹å¼ï¼š**
1. Gateway ä» Eureka è·å– `user-service` çš„åœ°å€
2. æ„é€  HTTP è¯·æ±‚ï¼š`http://<address>/api/users/1`
3. å‘é€ HTTP è¯·æ±‚

#### RPCï¼ˆgRPC + Consulï¼‰

```java
// gRPC å®¢æˆ·ç«¯é…ç½®
ManagedChannel channel = ManagedChannelBuilder
    .forTarget("consul://user-service")  // â† ä» Consul å‘ç°æœåŠ¡
    .build();
```

**å·¥ä½œæ–¹å¼ï¼š**
1. gRPC å®¢æˆ·ç«¯ä»æœåŠ¡å‘ç°ï¼ˆConsul/Eurekaï¼‰è·å–åœ°å€
2. å»ºç«‹ TCP è¿æ¥
3. å‘é€äºŒè¿›åˆ¶ RPC è¯·æ±‚

### 5. é”™è¯¯å¤„ç†

#### HTTP/REST

```java
// HTTP çŠ¶æ€ç 
200 OK           - æˆåŠŸ
400 Bad Request  - å®¢æˆ·ç«¯é”™è¯¯
404 Not Found    - èµ„æºä¸å­˜åœ¨
500 Internal Server Error - æœåŠ¡å™¨é”™è¯¯

// å“åº”ä½“åŒ…å«é”™è¯¯ä¿¡æ¯
{
  "error": "User not found",
  "code": "USER_NOT_FOUND"
}
```

**ç‰¹ç‚¹ï¼š**
- æ ‡å‡†åŒ–çš„é”™è¯¯ç ï¼ˆHTTP çŠ¶æ€ç ï¼‰
- é”™è¯¯ä¿¡æ¯åœ¨å“åº”ä½“ä¸­
- æ˜“äºè°ƒè¯•å’Œç†è§£

#### RPC

```java
// gRPC çŠ¶æ€ç 
OK                - æˆåŠŸ
NOT_FOUND         - èµ„æºä¸å­˜åœ¨
INVALID_ARGUMENT  - å‚æ•°é”™è¯¯
INTERNAL          - æœåŠ¡å™¨é”™è¯¯

// é”™è¯¯ä¿¡æ¯åœ¨ Status å¯¹è±¡ä¸­
Status status = Status.fromThrowable(e);
```

**ç‰¹ç‚¹ï¼š**
- æ¡†æ¶ç‰¹å®šçš„é”™è¯¯ç 
- é”™è¯¯ä¿¡æ¯åœ¨ Status å¯¹è±¡ä¸­
- éœ€è¦äº†è§£æ¡†æ¶æ‰èƒ½è°ƒè¯•

---

## å¾®æœåŠ¡åœºæ™¯ä¸‹çš„é€‰æ‹©

### ä½•æ—¶é€‰æ‹© HTTP/RESTï¼Ÿ

#### âœ… é€‚åˆçš„åœºæ™¯

1. **å…¬å¼€ API**
   - éœ€è¦å¯¹å¤–æš´éœ² API
   - å¤šç§å®¢æˆ·ç«¯ï¼ˆWebã€ç§»åŠ¨ç«¯ã€ç¬¬ä¸‰æ–¹ï¼‰
   - éœ€è¦æ ‡å‡†åŒ–æ¥å£

2. **è·¨è¯­è¨€è°ƒç”¨**
   - æœåŠ¡ä½¿ç”¨ä¸åŒè¯­è¨€å¼€å‘
   - HTTP æ˜¯é€šç”¨æ ‡å‡†
   - JSON æ‰€æœ‰è¯­è¨€éƒ½æ”¯æŒ

3. **è°ƒè¯•å’Œæµ‹è¯•**
   - éœ€è¦é¢‘ç¹è°ƒè¯•
   - ä½¿ç”¨æµè§ˆå™¨ã€Postman æµ‹è¯•
   - æ—¥å¿—å¯è¯»æ€§å¼º

4. **ç®€å•åœºæ™¯**
   - æœåŠ¡æ•°é‡ä¸å¤š
   - è°ƒç”¨é¢‘ç‡ä¸é«˜
   - æ€§èƒ½è¦æ±‚ä¸ä¸¥æ ¼

#### ğŸ“Š æˆ‘ä»¬é¡¹ç›®ä½¿ç”¨ HTTP/REST çš„åŸå› 

```
âœ… Spring Cloud ç”Ÿæ€æ”¯æŒå¥½
âœ… Feign Client ç®€åŒ–è°ƒç”¨
âœ… æ˜“äºè°ƒè¯•å’Œæµ‹è¯•
âœ… å­¦ä¹ æˆæœ¬ä½
âœ… é€‚åˆä¸­å°å‹é¡¹ç›®
```

### ä½•æ—¶é€‰æ‹© RPCï¼Ÿ

#### âœ… é€‚åˆçš„åœºæ™¯

1. **é«˜æ€§èƒ½è¦æ±‚**
   - é«˜å¹¶å‘åœºæ™¯
   - ä½å»¶è¿Ÿè¦æ±‚
   - å†…éƒ¨æœåŠ¡è°ƒç”¨

2. **åŒæ„æœåŠ¡**
   - æœåŠ¡ä½¿ç”¨ç›¸åŒè¯­è¨€
   - å¯ä»¥å…±äº«ä»£ç å’Œç±»å‹å®šä¹‰
   - å¼ºç±»å‹æ£€æŸ¥

3. **æµå¼ä¼ è¾“**
   - éœ€è¦æµå¼æ•°æ®ä¼ è¾“
   - å®æ—¶æ•°æ®æ¨é€
   - åŒå‘é€šä¿¡

4. **å¤§è§„æ¨¡ç³»ç»Ÿ**
   - æœåŠ¡æ•°é‡å¤š
   - è°ƒç”¨é¢‘ç‡é«˜
   - æ€§èƒ½ä¼˜åŒ–é‡è¦

#### ğŸ“Š å…¸å‹ RPC æ¡†æ¶

- **gRPC**ï¼šGoogle å¼€æºï¼Œä½¿ç”¨ Protocol Buffers
- **Thrift**ï¼šApache å¼€æºï¼Œæ”¯æŒå¤šç§è¯­è¨€
- **Dubbo**ï¼šé˜¿é‡Œå·´å·´å¼€æºï¼ŒJava ç”Ÿæ€
- **tRPC**ï¼šå­—èŠ‚è·³åŠ¨å¼€æºï¼Œé«˜æ€§èƒ½

---

## é¡¹ç›®ä¸­çš„å®ç°

### HTTP/REST å®ç°ï¼ˆæˆ‘ä»¬ä½¿ç”¨çš„ï¼‰

#### 1. Feign Client è°ƒç”¨

**æ–‡ä»¶ä½ç½®ï¼š**
```
shift-service/src/main/java/com/staffjoy/shift/client/UserServiceClient.java
```

**ä»£ç ï¼š**
```java
@FeignClient(name = "user-service", path = "/api/users")
public interface UserServiceClient {
    @GetMapping("/{id}")
    UserResponse getUserById(@PathVariable Long id);
}
```

**å®é™… HTTP è¯·æ±‚ï¼š**
```
GET /api/users/1 HTTP/1.1
Host: user-service:8081
Accept: application/json
```

**å“åº”ï¼š**
```
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 123

{
  "id": 1,
  "username": "john_doe",
  "email": "john@example.com",
  "name": "John Doe"
}
```

#### 2. è°ƒç”¨æµç¨‹

```
ShiftService.createShift()
  â†“
è°ƒç”¨ userServiceClient.getUserById(1)
  â†“
Feign æ‹¦æˆªè°ƒç”¨
  â†“
ä» Eureka è·å– user-service åœ°å€
  â†“
æ„é€  HTTP GET è¯·æ±‚
  GET http://localhost:8081/api/users/1
  â†“
å‘é€ HTTP è¯·æ±‚ï¼ˆä½¿ç”¨ RestTemplate/OkHttpï¼‰
  â†“
æ¥æ”¶ HTTP å“åº”
  HTTP/1.1 200 OK
  {"id": 1, "name": "John", ...}
  â†“
ååºåˆ—åŒ– JSON â†’ UserResponse å¯¹è±¡
  â†“
è¿”å›ç»™ ShiftService
```

#### 3. æ€§èƒ½å¼€é”€

```
1. åºåˆ—åŒ–ï¼šJava å¯¹è±¡ â†’ JSON å­—ç¬¦ä¸²
   å¼€é”€ï¼šä¸­ç­‰ï¼ˆJSON è§£æï¼‰

2. HTTP å¤´ï¼š~200-500 å­—èŠ‚
   å¼€é”€ï¼šè¾ƒå°ä½†ä¸å¯å¿½ç•¥

3. ç½‘ç»œä¼ è¾“ï¼šJSON æ–‡æœ¬
   å¼€é”€ï¼šè¾ƒå¤§ï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰

4. ååºåˆ—åŒ–ï¼šJSON å­—ç¬¦ä¸² â†’ Java å¯¹è±¡
   å¼€é”€ï¼šä¸­ç­‰ï¼ˆJSON è§£æï¼‰

æ€»å¼€é”€ï¼šè¾ƒé«˜ï¼ˆé€‚åˆä½é¢‘è°ƒç”¨ï¼‰
```

### RPC å®ç°ç¤ºä¾‹ï¼ˆå¯¹æ¯”ï¼‰

#### å¦‚æœä½¿ç”¨ gRPC

**1. å®šä¹‰æ¥å£ï¼ˆ.proto æ–‡ä»¶ï¼‰ï¼š**
```protobuf
syntax = "proto3";

service UserService {
  rpc GetUser(GetUserRequest) returns (UserResponse);
}

message GetUserRequest {
  int64 id = 1;
}

message UserResponse {
  int64 id = 1;
  string username = 2;
  string email = 3;
  string name = 4;
}
```

**2. ç”Ÿæˆä»£ç ï¼š**
```bash
protoc --java_out=. user.proto
# ç”Ÿæˆ UserServiceGrpc.java
```

**3. å®¢æˆ·ç«¯è°ƒç”¨ï¼š**
```java
ManagedChannel channel = ManagedChannelBuilder
    .forAddress("localhost", 8081)
    .usePlaintext()
    .build();

UserServiceGrpc.UserServiceBlockingStub stub = 
    UserServiceGrpc.newBlockingStub(channel);

GetUserRequest request = GetUserRequest.newBuilder()
    .setId(1)
    .build();

UserResponse response = stub.getUser(request);
```

**4. å®é™…ä¼ è¾“ï¼š**
```
TCP è¿æ¥å»ºç«‹
  â†“
å‘é€äºŒè¿›åˆ¶æ•°æ®åŒ…ï¼ˆProtocol Buffers ç¼–ç ï¼‰
  [0x08, 0x01, ...]  â† äºŒè¿›åˆ¶ï¼Œä¸å¯è¯»
  â†“
æ¥æ”¶äºŒè¿›åˆ¶å“åº”
  [0x08, 0x01, 0x12, 0x04, ...]
  â†“
ååºåˆ—åŒ–ä¸ºå¯¹è±¡
```

**5. æ€§èƒ½å¼€é”€ï¼š**
```
1. åºåˆ—åŒ–ï¼šJava å¯¹è±¡ â†’ Protocol Buffers äºŒè¿›åˆ¶
   å¼€é”€ï¼šä½ï¼ˆäºŒè¿›åˆ¶ç¼–ç ï¼‰

2. åè®®å¤´ï¼š~10-20 å­—èŠ‚
   å¼€é”€ï¼šå¾ˆå°

3. ç½‘ç»œä¼ è¾“ï¼šäºŒè¿›åˆ¶æ•°æ®
   å¼€é”€ï¼šå°ï¼ˆäºŒè¿›åˆ¶æ ¼å¼ï¼‰

4. ååºåˆ—åŒ–ï¼šäºŒè¿›åˆ¶ â†’ Java å¯¹è±¡
   å¼€é”€ï¼šä½ï¼ˆäºŒè¿›åˆ¶è§£æï¼‰

æ€»å¼€é”€ï¼šè¾ƒä½ï¼ˆé€‚åˆé«˜é¢‘è°ƒç”¨ï¼‰
```

---

## æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹

### åœºæ™¯ï¼šè°ƒç”¨ user-service è·å–ç”¨æˆ·ä¿¡æ¯

#### HTTP/RESTï¼ˆJSONï¼‰

```
è¯·æ±‚å¤§å°ï¼š~150 å­—èŠ‚
  GET /api/users/1 HTTP/1.1
  Host: user-service:8081
  Accept: application/json
  
å“åº”å¤§å°ï¼š~200 å­—èŠ‚
  HTTP/1.1 200 OK
  Content-Type: application/json
  
  {"id":1,"username":"john","email":"john@example.com","name":"John"}

åºåˆ—åŒ–æ—¶é—´ï¼š~0.5ms
ç½‘ç»œä¼ è¾“ï¼š~1msï¼ˆæœ¬åœ°ï¼‰
ååºåˆ—åŒ–æ—¶é—´ï¼š~0.5ms
æ€»æ—¶é—´ï¼š~2ms
```

#### RPCï¼ˆgRPC + Protocol Buffersï¼‰

```
è¯·æ±‚å¤§å°ï¼š~20 å­—èŠ‚ï¼ˆäºŒè¿›åˆ¶ï¼‰
  æœåŠ¡ID + æ–¹æ³•ID + å‚æ•°ï¼ˆid=1ï¼‰

å“åº”å¤§å°ï¼š~50 å­—èŠ‚ï¼ˆäºŒè¿›åˆ¶ï¼‰
  ç”¨æˆ·ä¿¡æ¯ï¼ˆäºŒè¿›åˆ¶ç¼–ç ï¼‰

åºåˆ—åŒ–æ—¶é—´ï¼š~0.1ms
ç½‘ç»œä¼ è¾“ï¼š~0.5msï¼ˆæœ¬åœ°ï¼‰
ååºåˆ—åŒ–æ—¶é—´ï¼š~0.1ms
æ€»æ—¶é—´ï¼š~0.7ms
```

**æ€§èƒ½å·®å¼‚ï¼š**
- RPC æ¯” HTTP/JSON **å¿«çº¦ 3 å€**
- RPC æ•°æ®é‡**å°çº¦ 4 å€**

---

## å®é™…é€‰æ‹©å»ºè®®

### æˆ‘ä»¬çš„é¡¹ç›®ï¼šä¸ºä»€ä¹ˆé€‰æ‹© HTTP/RESTï¼Ÿ

```
âœ… å­¦ä¹ é¡¹ç›®ï¼ŒHTTP/REST æ›´å®¹æ˜“ç†è§£
âœ… Spring Cloud ç”Ÿæ€æ”¯æŒå¥½
âœ… Feign Client ç®€åŒ–è°ƒç”¨
âœ… æ˜“äºè°ƒè¯•å’Œæµ‹è¯•
âœ… æ€§èƒ½è¶³å¤Ÿï¼ˆä¸­å°å‹é¡¹ç›®ï¼‰
```

### ç”Ÿäº§ç¯å¢ƒï¼šä½•æ—¶è€ƒè™‘ RPCï¼Ÿ

```
âœ… é«˜å¹¶å‘åœºæ™¯ï¼ˆQPS > 10000ï¼‰
âœ… ä½å»¶è¿Ÿè¦æ±‚ï¼ˆP99 < 10msï¼‰
âœ… å†…éƒ¨æœåŠ¡è°ƒç”¨ï¼ˆä¸éœ€è¦å¯¹å¤–æš´éœ²ï¼‰
âœ… åŒæ„æœåŠ¡ï¼ˆç›¸åŒè¯­è¨€ï¼‰
```

### æ··åˆä½¿ç”¨

**å®é™…ç”Ÿäº§ç¯å¢ƒå¸¸è§åšæ³•ï¼š**

```
å¤–éƒ¨ APIï¼šHTTP/REST
  â†“
API Gateway
  â†“
å†…éƒ¨æœåŠ¡é—´è°ƒç”¨ï¼šRPCï¼ˆgRPCï¼‰
  â†“
å¾®æœåŠ¡ A â†â†’ å¾®æœåŠ¡ Bï¼ˆRPCï¼‰
å¾®æœåŠ¡ A â†â†’ å¾®æœåŠ¡ Cï¼ˆRPCï¼‰
```

---

## ğŸ“ æ€»ç»“ï¼šç¬¬ä¸€æ€§åŸç†

### æ ¸å¿ƒåŒºåˆ«

| ç»´åº¦ | HTTP/REST | RPC |
|------|-----------|-----|
| **æœ¬è´¨** | æ–‡æ¡£ä¼ è¾“åè®® | è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®® |
| **ç›®æ ‡** | ä¼ è¾“èµ„æºï¼ˆèµ„æºå¯¼å‘ï¼‰ | è°ƒç”¨æ–¹æ³•ï¼ˆæ–¹æ³•å¯¼å‘ï¼‰ |
| **æ ¼å¼** | æ–‡æœ¬ï¼ˆJSON/XMLï¼‰ | äºŒè¿›åˆ¶ï¼ˆProtocol Buffersç­‰ï¼‰ |
| **è°ƒç”¨æ–¹å¼** | æ˜¾å¼ï¼ˆURL + HTTPæ–¹æ³•ï¼‰ | éšå¼ï¼ˆçœ‹èµ·æ¥åƒæœ¬åœ°è°ƒç”¨ï¼‰ |
| **æ€§èƒ½** | è¾ƒä½ | è¾ƒé«˜ |
| **å¯è¯»æ€§** | é«˜ | ä½ |
| **æ ‡å‡†åŒ–** | é«˜ï¼ˆHTTPæ ‡å‡†ï¼‰ | ä½ï¼ˆæ¡†æ¶ç‰¹å®šï¼‰ |
| **é€‚ç”¨åœºæ™¯** | å…¬å¼€APIã€è·¨è¯­è¨€ | å†…éƒ¨è°ƒç”¨ã€é«˜æ€§èƒ½ |

### é€‰æ‹©åŸåˆ™

1. **å…¬å¼€ API â†’ HTTP/REST**
   - éœ€è¦æ ‡å‡†åŒ–
   - å¤šç§å®¢æˆ·ç«¯
   - æ˜“äºè°ƒè¯•

2. **å†…éƒ¨è°ƒç”¨ â†’ RPC**
   - é«˜æ€§èƒ½è¦æ±‚
   - åŒæ„æœåŠ¡
   - é¢‘ç¹è°ƒç”¨

3. **å­¦ä¹ é¡¹ç›® â†’ HTTP/REST**
   - æ˜“äºç†è§£
   - å·¥å…·ä¸°å¯Œ
   - ç”Ÿæ€æˆç†Ÿ

### å…³é”®æ´å¯Ÿ

**HTTP/REST å’Œ RPC ä¸æ˜¯å¯¹ç«‹çš„ï¼Œè€Œæ˜¯äº’è¡¥çš„ï¼š**
- **HTTP/REST**ï¼šé€‚åˆ**å¤–éƒ¨æ¥å£**å’Œ**ç®€å•åœºæ™¯**
- **RPC**ï¼šé€‚åˆ**å†…éƒ¨è°ƒç”¨**å’Œ**é«˜æ€§èƒ½åœºæ™¯**

**ç°ä»£å¾®æœåŠ¡æ¶æ„é€šå¸¸æ··åˆä½¿ç”¨ï¼š**
- å¯¹å¤–ï¼šHTTP/REST API
- å¯¹å†…ï¼šRPC è°ƒç”¨

---

## ğŸ“š è¿›ä¸€æ­¥å­¦ä¹ 

### ç›¸å…³æ–‡æ¡£
- [æœåŠ¡æ³¨å†Œå‘ç°ä¸é…ç½®ä¸­å¿ƒ](SERVICE_DISCOVERY_AND_CONFIG.md)
- [å¾®æœåŠ¡æ¶æ„è¯´æ˜](MICROSERVICES_ARCHITECTURE.md)

### å®è·µå»ºè®®

1. **ç†è§£ HTTP è¯·æ±‚**
   - ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹ HTTP è¯·æ±‚
   - ä½¿ç”¨ Postman æµ‹è¯• API
   - è§‚å¯Ÿè¯·æ±‚å¤´å’Œå“åº”å¤´

2. **å¯¹æ¯”æ€§èƒ½**
   - æµ‹è¯• HTTP/REST è°ƒç”¨çš„å»¶è¿Ÿ
   - å¦‚æœä½¿ç”¨ RPCï¼Œå¯¹æ¯”æ€§èƒ½å·®å¼‚

3. **å­¦ä¹  RPC æ¡†æ¶**
   - äº†è§£ gRPC çš„åŸºæœ¬æ¦‚å¿µ
   - å°è¯•å®ç°ä¸€ä¸ªç®€å•çš„ gRPC æœåŠ¡

---

**è®°ä½ï¼šæŠ€æœ¯é€‰æ‹©å–å†³äºå…·ä½“åœºæ™¯ã€‚ç†è§£äº†æœ¬è´¨åŒºåˆ«ï¼Œé€‰æ‹©å°±å˜å¾—æ¸…æ™°äº†ï¼** ğŸ¯

