
# Kubernetes éƒ¨ç½²æ–¹å¼å¯¹æ¯”

## ğŸ¤” å¸¸è§è¯¯è§£æ¾„æ¸…

**è¯¯è§£ï¼š** Kubernetes é›†ç¾¤ = Google Cloud

**äº‹å®ï¼š** Kubernetes æ˜¯ä¸€ä¸ª**å¼€æºçš„å®¹å™¨ç¼–æ’å¹³å°**ï¼Œä¸ç»‘å®šä»»ä½•äº‘æœåŠ¡å•†ã€‚å®ƒå¯ä»¥è¿è¡Œåœ¨ä»»ä½•åœ°æ–¹ï¼š
- æœ¬åœ°ç¯å¢ƒï¼ˆMinikubeã€Kindã€Docker Desktopï¼‰
- ä»»ä½•äº‘æœåŠ¡å•†çš„æ‰˜ç®¡ Kubernetes æœåŠ¡
- è‡ªå»º Kubernetes é›†ç¾¤

## ğŸ“Š Kubernetes vs äº‘æœåŠ¡å•†æ‰˜ç®¡æœåŠ¡

### Kubernetesï¼ˆé€šç”¨ï¼‰

Kubernetesï¼ˆK8sï¼‰æ˜¯ä¸€ä¸ª**å¼€æºé¡¹ç›®**ï¼Œç”± CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰ç»´æŠ¤ã€‚

**ç‰¹ç‚¹ï¼š**
- âœ… å¼€æºã€æ ‡å‡†åŒ–
- âœ… å¯è¿è¡Œåœ¨ä»»ä½•ç¯å¢ƒ
- âœ… é…ç½®é€šç”¨ï¼Œå¯ç§»æ¤æ€§å¼º
- âœ… ä¸ä¾èµ–ç‰¹å®šäº‘æœåŠ¡å•†

**é€‚ç”¨åœºæ™¯ï¼š**
- æœ¬åœ°å¼€å‘æµ‹è¯•
- å¤šäº‘éƒ¨ç½²ï¼ˆéœ€è¦è·¨äº‘æœåŠ¡å•†ï¼‰
- è‡ªå»ºé›†ç¾¤
- å­¦ä¹  Kubernetes æœ¬èº«

### äº‘æœåŠ¡å•†æ‰˜ç®¡ Kubernetes æœåŠ¡

å„å¤§äº‘æœåŠ¡å•†éƒ½æä¾›**æ‰˜ç®¡çš„ Kubernetes æœåŠ¡**ï¼ŒåŸºäºå¼€æº Kubernetesï¼Œä½†æ·»åŠ äº†äº‘æœåŠ¡å•†ç‰¹å®šçš„åŠŸèƒ½ã€‚

| äº‘æœåŠ¡å•† | æ‰˜ç®¡ Kubernetes æœåŠ¡åç§° | ç‰¹ç‚¹ |
|---------|------------------------|------|
| **Google Cloud** | GKE (Google Kubernetes Engine) | æœ€æ—©æ¨å‡ºï¼ŒåŠŸèƒ½æˆç†Ÿ |
| **é˜¿é‡Œäº‘** | ACK (Alibaba Cloud Container Service) | å›½å†…è®¿é—®å¿«ï¼Œä¸­æ–‡æ”¯æŒå¥½ |
| **AWS** | EKS (Elastic Kubernetes Service) | ä¸ AWS æœåŠ¡é›†æˆç´§å¯† |
| **Azure** | AKS (Azure Kubernetes Service) | ä¸ Azure æœåŠ¡é›†æˆ |
| **è…¾è®¯äº‘** | TKE (Tencent Kubernetes Engine) | å›½å†…æœåŠ¡ï¼Œä¸è…¾è®¯äº‘é›†æˆ |
| **åä¸ºäº‘** | CCE (Cloud Container Engine) | å›½å†…æœåŠ¡ |

## ğŸ” ä¸¤ç§éƒ¨ç½²æ–¹å¼çš„åŒºåˆ«

### 1. é€šç”¨ Kubernetes éƒ¨ç½² (`k8s/`)

**ä½ç½®ï¼š** `k8s/deployments/`, `k8s/services/` ç­‰

**ç‰¹ç‚¹ï¼š**
- âœ… ä½¿ç”¨æ ‡å‡† Kubernetes API
- âœ… é•œåƒåœ°å€å¯ä»¥æ˜¯ä»»ä½•é•œåƒä»“åº“ï¼ˆDocker Hubã€Harborã€ç§æœ‰ä»“åº“ç­‰ï¼‰
- âœ… é…ç½®é€šç”¨ï¼Œå¯éƒ¨ç½²åˆ°ä»»ä½• K8s é›†ç¾¤
- âœ… Ingress ä½¿ç”¨æ ‡å‡†é…ç½®ï¼ˆNginxã€Traefik ç­‰ï¼‰

**ç¤ºä¾‹é…ç½®ï¼š**
```yaml
# é•œåƒå¯ä»¥æ˜¯ä»»ä½•åœ°å€
image: staffjoy-eureka-server:latest  # Docker Hub
image: registry.example.com/staffjoy/eureka-server:latest  # ç§æœ‰ä»“åº“
imagePullPolicy: IfNotPresent  # æœ¬åœ°å¼€å‘å¸¸ç”¨
```

**é€‚ç”¨åœºæ™¯ï¼š**
- æœ¬åœ°å¼€å‘ï¼ˆMinikubeã€Kindï¼‰
- æµ‹è¯•ç¯å¢ƒ
- å¤šäº‘éƒ¨ç½²
- å­¦ä¹  Kubernetes

### 2. é˜¿é‡Œäº‘ ACK éƒ¨ç½² (`k8s/alibaba-cloud/`)

**ä½ç½®ï¼š** `k8s/alibaba-cloud/`

**ç‰¹ç‚¹ï¼š**
- âœ… ä½¿ç”¨é˜¿é‡Œäº‘ ACRï¼ˆå®¹å™¨é•œåƒæœåŠ¡ï¼‰å­˜å‚¨é•œåƒ
- âœ… ä½¿ç”¨é˜¿é‡Œäº‘ ALB Ingressï¼ˆåº”ç”¨å‹è´Ÿè½½å‡è¡¡ï¼‰
- âœ… é›†æˆé˜¿é‡Œäº‘ç›‘æ§ã€æ—¥å¿—ç­‰æœåŠ¡
- âœ… é•œåƒåœ°å€æ ¼å¼ï¼š`registry.cn-<åœ°åŸŸ>.aliyuncs.com/<å‘½åç©ºé—´>/<æœåŠ¡å>:<ç‰ˆæœ¬>`
- âœ… éœ€è¦é…ç½®é˜¿é‡Œäº‘ç‰¹å®šçš„ Secret å’Œæ³¨è§£

**ç¤ºä¾‹é…ç½®ï¼š**
```yaml
# é•œåƒåœ°å€å¿…é¡»æ˜¯ ACR æ ¼å¼
image: registry.cn-hangzhou.aliyuncs.com/staffjoy/eureka-server:v1.0.0
imagePullPolicy: Always  # ç”Ÿäº§ç¯å¢ƒæ¨è
imagePullSecrets:
- name: acr-secret  # é˜¿é‡Œäº‘ ACR è®¿é—®å‡­è¯
```

**Ingress é…ç½®ï¼š**
```yaml
annotations:
  alb.ingress.kubernetes.io/name: staffjoy-api-ingress  # é˜¿é‡Œäº‘ç‰¹å®šæ³¨è§£
  alb.ingress.kubernetes.io/loadbalancer-spec: "slb.s2.small"  # é˜¿é‡Œäº‘è´Ÿè½½å‡è¡¡è§„æ ¼
```

**é€‚ç”¨åœºæ™¯ï¼š**
- é˜¿é‡Œäº‘ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- éœ€è¦é˜¿é‡Œäº‘æœåŠ¡é›†æˆï¼ˆSLBã€ç›‘æ§ã€æ—¥å¿—ç­‰ï¼‰
- å›½å†…ç”¨æˆ·è®¿é—®
- éœ€è¦ä¸­æ–‡æŠ€æœ¯æ”¯æŒ

## ğŸ“‹ è¯¦ç»†å¯¹æ¯”è¡¨

| å¯¹æ¯”é¡¹ | é€šç”¨ Kubernetes | é˜¿é‡Œäº‘ ACK |
|-------|----------------|-----------|
| **é•œåƒä»“åº“** | ä»»ä½•é•œåƒä»“åº“ | é˜¿é‡Œäº‘ ACRï¼ˆæ¨èï¼‰ |
| **é•œåƒåœ°å€æ ¼å¼** | çµæ´» | `registry.cn-<åœ°åŸŸ>.aliyuncs.com/...` |
| **Ingress** | Nginxã€Traefik ç­‰æ ‡å‡† Ingress | é˜¿é‡Œäº‘ ALB Ingress |
| **è´Ÿè½½å‡è¡¡** | äº‘æœåŠ¡å•†æ ‡å‡† LoadBalancer | é˜¿é‡Œäº‘ SLBï¼ˆåº”ç”¨å‹ï¼‰ |
| **é…ç½®å¤æ‚åº¦** | ç®€å• | éœ€è¦é˜¿é‡Œäº‘ç‰¹å®šé…ç½® |
| **å¯ç§»æ¤æ€§** | é«˜ï¼ˆå¯éƒ¨ç½²åˆ°ä»»ä½• K8sï¼‰ | ä½ï¼ˆç»‘å®šé˜¿é‡Œäº‘ï¼‰ |
| **æˆæœ¬** | å–å†³äºåŸºç¡€è®¾æ–½ | é˜¿é‡Œäº‘å®šä»· |
| **è®¿é—®é€Ÿåº¦** | å–å†³äºé•œåƒä»“åº“ä½ç½® | å›½å†…è®¿é—®å¿« |
| **æŠ€æœ¯æ”¯æŒ** | ç¤¾åŒºæ”¯æŒ | é˜¿é‡Œäº‘æŠ€æœ¯æ”¯æŒ |

## ğŸ¯ å¦‚ä½•é€‰æ‹©ï¼Ÿ

### é€‰æ‹©é€šç”¨ Kubernetes éƒ¨ç½²ï¼Œå¦‚æœï¼š

1. âœ… **æœ¬åœ°å¼€å‘æµ‹è¯•**
   ```bash
   # ä½¿ç”¨ Minikube æˆ– Kind
   minikube start
   kubectl apply -f k8s/deployments/
   ```

2. âœ… **å­¦ä¹  Kubernetes**
   - ç†è§£æ ‡å‡† Kubernetes æ¦‚å¿µ
   - ä¸ä¾èµ–ç‰¹å®šäº‘æœåŠ¡å•†

3. âœ… **å¤šäº‘éƒ¨ç½²**
   - éœ€è¦éƒ¨ç½²åˆ°å¤šä¸ªäº‘æœåŠ¡å•†
   - é¿å…ä¾›åº”å•†é”å®š

4. âœ… **ä½¿ç”¨å…¶ä»–äº‘æœåŠ¡å•†**
   - Google GKEã€AWS EKSã€Azure AKS ç­‰
   - åªéœ€ä¿®æ”¹é•œåƒåœ°å€å’Œ Ingress é…ç½®

### é€‰æ‹©é˜¿é‡Œäº‘ ACK éƒ¨ç½²ï¼Œå¦‚æœï¼š

1. âœ… **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²åˆ°é˜¿é‡Œäº‘**
   ```bash
   cd k8s/alibaba-cloud
   ./build-and-push-images.sh v1.0.0
   ./deploy-to-ack.sh
   ```

2. âœ… **éœ€è¦é˜¿é‡Œäº‘æœåŠ¡é›†æˆ**
   - é˜¿é‡Œäº‘ç›‘æ§ï¼ˆARMSï¼‰
   - é˜¿é‡Œäº‘æ—¥å¿—ï¼ˆSLSï¼‰
   - é˜¿é‡Œäº‘ SLB

3. âœ… **å›½å†…ç”¨æˆ·è®¿é—®**
   - é•œåƒæ‹‰å–é€Ÿåº¦å¿«
   - ä¸­æ–‡æŠ€æœ¯æ”¯æŒ

4. âœ… **å·²æœ‰é˜¿é‡Œäº‘åŸºç¡€è®¾æ–½**
   - å·²æœ‰ ACR é•œåƒä»“åº“
   - å·²æœ‰ ACK é›†ç¾¤

## ğŸ”„ ä»é€šç”¨éƒ¨ç½²è¿ç§»åˆ°é˜¿é‡Œäº‘ ACK

å¦‚æœæ‚¨å·²ç»ä½¿ç”¨é€šç”¨ Kubernetes éƒ¨ç½²ï¼Œè¿ç§»åˆ°é˜¿é‡Œäº‘ ACK å¾ˆç®€å•ï¼š

### æ­¥éª¤ 1: æ„å»ºå¹¶æ¨é€é•œåƒåˆ° ACR

```bash
cd k8s/alibaba-cloud
./build-and-push-images.sh v1.0.0
```

### æ­¥éª¤ 2: æ›´æ–°é•œåƒåœ°å€

```bash
./update-image-references.sh v1.0.0
```

### æ­¥éª¤ 3: åˆ›å»º ACR Secret

```bash
kubectl create secret docker-registry acr-secret \
  --docker-server=registry.cn-hangzhou.aliyuncs.com \
  --docker-username=YOUR_USERNAME \
  --docker-password=YOUR_PASSWORD \
  --namespace=default
```

### æ­¥éª¤ 4: éƒ¨ç½²

```bash
./deploy-to-ack.sh
```

## ğŸ“š æ€»ç»“

| æ¦‚å¿µ | è¯´æ˜ |
|-----|------|
| **Kubernetes** | å¼€æºå®¹å™¨ç¼–æ’å¹³å°ï¼Œä¸ç»‘å®šä»»ä½•äº‘æœåŠ¡å•† |
| **é€šç”¨ K8s éƒ¨ç½²** | ä½¿ç”¨æ ‡å‡† Kubernetes APIï¼Œå¯éƒ¨ç½²åˆ°ä»»ä½• K8s é›†ç¾¤ |
| **é˜¿é‡Œäº‘ ACK** | é˜¿é‡Œäº‘æä¾›çš„æ‰˜ç®¡ Kubernetes æœåŠ¡ |
| **Google GKE** | Google Cloud æä¾›çš„æ‰˜ç®¡ Kubernetes æœåŠ¡ |
| **AWS EKS** | AWS æä¾›çš„æ‰˜ç®¡ Kubernetes æœåŠ¡ |

**å…³é”®ç‚¹ï¼š**
- Kubernetes æœ¬èº«æ˜¯å¼€æºçš„ï¼Œä¸ç»‘å®š Google Cloud
- é€šç”¨éƒ¨ç½² = æ ‡å‡† Kubernetesï¼Œå¯éƒ¨ç½²åˆ°ä»»ä½•åœ°æ–¹
- é˜¿é‡Œäº‘ ACK éƒ¨ç½² = é’ˆå¯¹é˜¿é‡Œäº‘çš„ä¼˜åŒ–é…ç½®
- ä¸¤è€…ä½¿ç”¨ç›¸åŒçš„ Kubernetes APIï¼Œåªæ˜¯é…ç½®ä¸åŒ

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é€šç”¨ Kubernetes éƒ¨ç½²æŒ‡å—](README.md)
- [é˜¿é‡Œäº‘ ACK éƒ¨ç½²æŒ‡å—](alibaba-cloud/README.md)
- [Kubernetes å®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/)
- [é˜¿é‡Œäº‘ ACK æ–‡æ¡£](https://help.aliyun.com/product/85222.html)

